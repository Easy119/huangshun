webpackJsonp([143],{"1vHF":function(t,e){},"5XW8":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("3cXf"),s=i.n(a),o=i("2hMI"),l=i("yclV"),n={data:function(){return{type:1,pagetype:1,pagefrom:1,typename:"项目",projectId:-1,projectName:"",noprojectselect:!1,fileType:{value:"",filetypeList:[],placeholder:"请选择"},fileList:"",currentName:"",search:"",fileuploadDialog:!1,uploadfile:{projectList:"",projectVal:"",projectId:"",folderList:"",folderListVal:"",folderListId:"",fileList:[],tagList:"",tagListVal:"",tagListId:""},showNumber:!0}},watch:{$route:function(t,e){this.initData()}},created:function(){this.initData()},computed:{total:function(){return this.fileType.filetypeList.length-1<0?0:this.fileType.filetypeList.length-1},projectIdError:function(){return""==this.uploadfile.projectVal},folderIdError:function(){return""==this.uploadfile.folderListVal},fileListError:function(){var t=0;return this.uploadfile.fileList.length>0&&this.uploadfile.fileList.forEach(function(e){e.typeCheck||t++}),t>0?"暂不支持视频和音频文件":""},tagListError:function(){return this.uploadfile.tagListVal,!1},submitOk:function(){return 1==this.type?!this.projectIdError&&!this.folderIdError&&""==this.fileListError&&!this.tagListError&&this.uploadfile.fileList.length>0:!this.projectIdError&&!this.folderIdError&&""==this.fileListError&&this.uploadfile.fileList.length>0}},mounted:function(){},methods:{initData:function(){"directInvestProjectRunProjectFile"==this.$route.name?(this.type=1,this.typename="项目"):(this.type=2,this.typename="基金"),void 0!=this.$route.query.projectId?this.projectId=this.$route.query.projectId:this.projectId=-1,this.$route.query.from&&1!=this.$route.query.from?(this.pagetype=2,this.pagefrom=this.$route.query.from,this.projectName=this.$route.query.cName):(this.pagetype=1,this.pagefrom=1),void 0!=this.$route.query.isNewProject&&(this.showNumber=!1),this.initProjectType(),this.initFolderList()},initProjectType:function(){var t=this;Object(o.L)({type:this.type}).then(function(e){1==e.data.msgNo&&(t.fileType.filetypeList=e.data.payload.data,0==e.data.payload.data.length?t.fileType.placeholder="暂无数据":(t.fileType.filetypeList.unshift({id:-1,name:"全部"}),-1==t.projectId?t.fileType.value="":t.fileType.filetypeList.forEach(function(e){e.id==t.projectId&&(t.fileType.value=e.name)})))})},gotoDocumentView:function(){var t=JSON.parse(s()(this.$route.query));t.type=this.type,this.$router.push({name:"directInvestProjectRunProjectFileView",query:t})},initFolderList:function(){var t=this;this.currentName="";var e={type:this.type,search:this.search};-1!=this.projectId&&(e.id=this.projectId),Object(o._310)(e).then(function(e){if(1==e.data.msgNo){var i=e.data.payload.data;i.forEach(function(t){t.edited=!1,t.error="",t.error_show=!1}),i.unshift({id:-1,dirname:"",add_time:"",error:"",count:0,amend:0,error_show:!1}),t.fileList=i}})},changeProject:function(t){this.projectId=t,this.noprojectselect=!1,this.initFolderList()},createNewfileFun:function(){-1==this.projectId?(Object(l.g)("info","您还没有选择"+this.typename),this.noprojectselect=!0):(this.fileList[0].id=-2,this.fileList[0].dirname="",this.fileList[0].edited=!0,this.fileList[0].add_time=(new Date).Format("yyyy-MM-dd hh:mm:ss"))},editNameFunc:function(t){this.fileList.forEach(function(t,e){0==e?t.id=-1:t.edited=!1}),this.fileList[t].edited=!0,this.currentName=this.fileList[t].dirname},commitEditname:function(t){var e=this,i=this.fileList[t];""!=i.dirname?0==t?Object(o._279)({type:this.type,dirname:i.dirname,id:this.projectId,pid:""}).then(function(t){1==t.data.msgNo?(Object(l.g)("success","文件创建成功"),e.initFolderList()):Object(l.g)("fail",t.data.message)}):this.currentName==i.dirname?this.fileList[t].edited=!1:Object(o._99)({type:this.type,dirname:i.dirname,dirId:i.id}).then(function(t){1==t.data.msgNo?(Object(l.g)("success","文件修改成功"),e.initFolderList()):Object(l.g)("fail",t.data.message)}):this.fileList[t].error="*文件名不能为空"},cancelEditname:function(t){0==t?this.fileList[t].id=-1:(this.fileList[t].edited=!1,this.fileList[t].dirname=this.currentName)},hideError:function(t){this.fileList[t].error=""},hideEdit:function(t){this.fileList[t].dirname==this.currentName&&(0==t?this.fileList[t].id=-1:this.fileList[t].edited=!1)},deleteFileFunc:function(t){var e=this;Object(o._45)({type:this.type,dirId:this.fileList[t].id,count:this.fileList[t].count}).then(function(t){1==t.data.msgNo?(Object(l.g)("success","文件夹删除成功"),e.initFolderList()):Object(l.g)("fail",t.data.message)})},gotoDocumentList:function(t,e,i,a){var s="";0!=i&&(this.projectId=a),s=1==this.type?"directInvestProjectRunProjectFileDoc":"fundDocumentManage",-1!=t&&-2!=t&&this.$router.push({name:s,query:{folderId:t,folderName:e,projectId:this.projectId,ammend:i,pname:this.projectName,from:this.pagefrom}})},getProjectList:function(){var t=this;Object(o.L)({type:this.type}).then(function(e){1==e.data.msgNo&&(t.uploadfile.projectList=e.data.payload.data,-1==t.projectId?(t.uploadfile.projectVal="",t.uploadfile.projectId=""):(t.uploadfile.projectId=t.projectId,t.uploadfile.projectList.forEach(function(e){e.id==t.uploadfile.projectId&&(t.uploadfile.projectVal=e.name)})),t.getFolderList())})},getFolderList:function(){var t=this;Object(o._310)({type:this.type,id:this.uploadfile.projectId}).then(function(e){1==e.data.msgNo&&(t.uploadfile.folderList=e.data.payload.data,t.uploadfile.folderListVal="",t.uploadfile.folderListId=t.uploadfile.folderList[0].id)})},getTagsList:function(){var t=this;Object(o._232)().then(function(e){1==e.data.msgNo&&(t.uploadfile.tagList=e.data.payload,t.uploadfile.tagListVal="",t.uploadfile.tagListId=0)})},changeModalselect:function(t,e){this.uploadfile[t]=e},getFileType:function(t){var e=t.substring(t.lastIndexOf("."),t.length);return-1==[".3gpp",".ac3",".mp2",".mp3",".mp4",".mpeg",".mpg",".wma",".aac"].indexOf(e)},fileListChange:function(t,e){var i=this;this.uploadfile.fileList=[],e.forEach(function(t){var e=Object(l.k)(t.name);t.typeCheck=i.getFileType(t.name),""==e?Object(l.g)("info","不支持上传此格式"):i.uploadfile.fileList.push(t)})},uploadFileFun:function(){1!=this.fileType.filetypeList.length?(this.fileuploadDialog=!0,this.uploadfile={projectList:"",projectVal:"",projectId:"",folderList:"",folderListVal:"",folderListId:"",fileList:[],tagList:"",tagListVal:"",tagListId:""},this.getProjectList(),this.getTagsList()):Object(l.g)("info","您还没有项目，请先创建项目")},deleteFile:function(t){this.uploadfile.fileList.splice(t,1)},dialogClose:function(){var t=this;this.uploadfile.fileList.length>0?Object(l.h)("确定不提交并关闭吗？").then(function(){t.fileuploadDialog=!1}).catch(function(){}):this.fileuploadDialog=!1},submitClick:function(){var t=this;if(this.submitOk){var e={type:this.type,companyId:this.uploadfile.projectId,dirId:this.uploadfile.folderListId};1==this.type?e.tagId=this.uploadfile.tagListId:e.tagId="";var i=[];this.uploadfile.fileList.forEach(function(t){i.push(t.raw)}),Object(o._6)(e,i).then(function(e){1==e.data.msgNo?Object(l.g)("success","文件上传成功"):Object(l.g)("error",e.data.message),t.fileuploadDialog=!1,t.uploadfile.fileList=[],t.initFolderList()})}else this.projectIdError||this.folderIdError||this.tagListError||0==this.uploadfile.fileList.length?Object(l.g)("info","您还有必填项没有填写～"):Object(l.g)("info","文件格式不正确")}}},r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"personal-content-body"},[i("div",{staticClass:"content folder-content"},[i("div",{staticClass:"content-title clear"},[i("div",{staticClass:"left"},[t._v(t._s(t.typename)+"文件管理")]),t._v(" "),i("el-input",{staticClass:"header-right-time right",attrs:{placeholder:"输入文件关键字进行搜索",clearable:!0},on:{change:t.initFolderList},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}},[i("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})]),t._v(" "),2!=t.pagetype?i("div",{staticClass:"historyapply-group-top-dropdown select-normal right",class:{"select-normal-highlight":t.noprojectselect},staticStyle:{"margin-right":"15px"}},[i("el-select",{attrs:{filterable:"",placeholder:"请选择",disabled:!t.showNumber},on:{change:function(e){t.changeProject(e)}},model:{value:t.fileType.value,callback:function(e){t.$set(t.fileType,"value",e)},expression:"fileType.value"}},t._l(t.fileType.filetypeList,function(t){return i("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1):t._e()],1),t._v(" "),i("div",{staticClass:"historyapply-group folder-historyapply-group"},[i("div",{staticClass:"historyapply-group-top clear"},[2!=t.pagetype&&t.showNumber?i("div",{staticClass:"historyapply-group-top-title left"},[t._v("共包含"+t._s(t.total)+"个"+t._s(t.typename))]):t._e(),t._v(" "),i("div",{staticClass:"right"},[i("div",{staticClass:"historyapply-group-top-btn right",on:{click:t.uploadFileFun}},[i("span",{staticClass:"filemanage-icon icon-upload"}),t._v("上传文件\n          ")]),t._v(" "),i("div",{staticClass:"historyapply-group-top-btn right",on:{click:t.createNewfileFun}},[i("span",{staticClass:"filemanage-icon icon-create"}),t._v("新建文件夹\n          ")]),t._v(" "),1==t.type?i("div",{staticClass:"historyapply-group-top-btn right",on:{click:t.gotoDocumentView}},[i("span",{staticClass:"filemanage-icon icon-view"}),t._v("文件总览\n          ")]):t._e()]),t._v(" "),i("div",{staticClass:"clear"})]),t._v(" "),i("div",{staticClass:"foldermanage-content"},[i("div",{staticClass:"foldermanage-content-table clear"},[t._m(0),t._v(" "),i("div",{staticClass:"foldermanage-content-table-line"}),t._v(" "),i("div",{staticClass:"foldermanage-content-table-content"},t._l(t.fileList,function(e,a){return i("div",{on:{click:function(i){t.gotoDocumentList(e.id,e.dirname,e.amend,e.companyId)}}},[-1!=e.id?i("div",{staticClass:"foldermanage-content-table-tr clear"},[i("div",{staticClass:"table-td1 clear"},[i("span",{staticClass:"filemanage-icon icon-folder left"}),t._v(" "),i("div",{staticClass:"filename-box left"},[e.edited?t._e():i("div",{staticClass:"filename-box-text"},[t._v(t._s(e.dirname))]),t._v(" "),e.edited?i("input",{directives:[{name:"model",rawName:"v-model",value:e.dirname,expression:"item.dirname"}],staticClass:"filename-box-input",class:{"filename-box-input-error":""!=e.error},attrs:{type:"text",name:"",maxlength:"20"},domProps:{value:e.dirname},on:{click:function(t){t.stopPropagation()},focus:function(e){e.stopPropagation(),t.hideError(a)},blur:function(e){t.hideEdit(a)},input:function(i){i.target.composing||t.$set(e,"dirname",i.target.value)}}}):t._e(),t._v(" "),i("span",{staticClass:"filename-box-input-errortext"},[t._v(t._s(e.error))])]),t._v(" "),e.edited?i("div",{staticClass:"filename-btnbox left"},[i("span",{staticClass:"filemanage-icon icon-zq left",on:{click:function(e){e.stopPropagation(),t.commitEditname(a)}}}),t._v(" "),i("span",{staticClass:"filemanage-icon icon-cw left",on:{click:function(e){e.stopPropagation(),t.cancelEditname(a)}}})]):t._e(),t._v(" "),1==e.amend?i("div",{staticClass:"filename-btnbox-right right"},[i("span",{staticClass:"filemanage-icon icon-delete",on:{click:function(e){e.stopPropagation(),t.deleteFileFunc(a)}}}),t._v(" "),i("span",{staticClass:"filemanage-icon icon-edit",on:{click:function(e){e.stopPropagation(),t.editNameFunc(a)}}})]):t._e()]),t._v(" "),i("div",{staticClass:"table-td2"},[t._v("\n                  "+t._s(e.count)+"个文件\n                ")]),t._v(" "),i("div",{staticClass:"table-td3"},[t._v("\n                  "+t._s(e.edit_time)+"\n                ")])]):t._e(),t._v(" "),i("div",{staticClass:"foldermanage-content-table-line"})])}))])])]),t._v(" "),i("el-dialog",{attrs:{title:"文件上传",visible:t.fileuploadDialog,width:"900px",center:"","append-to-body":!0,"before-close":t.dialogClose},on:{"update:visible":function(e){t.fileuploadDialog=e}}},[i("div",{staticClass:"dialog_content"},[i("div",{staticClass:"form-group margin-bottom-none"},[i("div",{staticClass:"form-group-inputboxgroup clear"},[i("div",{staticClass:"form-group-inputbox"},[i("h2",{staticClass:"form-group-inputbox-title"},[i("span",{staticClass:"account-icon icon-required"}),t._v("所属项目")]),t._v(" "),i("div",{staticClass:"form-group-inputbox-selectbox select-normal-40 left"},[i("el-select",{attrs:{filterable:"",placeholder:"请选择"},on:{change:function(e){t.changeModalselect("projectId",e),t.getFolderList()}},model:{value:t.uploadfile.projectVal,callback:function(e){t.$set(t.uploadfile,"projectVal",e)},expression:"uploadfile.projectVal"}},t._l(t.uploadfile.projectList,function(t){return i("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),i("span",{staticClass:"form-group-inputbox-error"})]),t._v(" "),i("div",{staticClass:"form-group-inputbox"},[i("h2",{staticClass:"form-group-inputbox-title"},[i("span",{staticClass:"account-icon icon-required"}),t._v("文件分类")]),t._v(" "),i("div",{staticClass:"form-group-inputbox-selectbox select-normal-40 left"},[i("el-select",{attrs:{filterable:"",placeholder:"请选择"},on:{change:function(e){t.changeModalselect("folderListId",e)}},model:{value:t.uploadfile.folderListVal,callback:function(e){t.$set(t.uploadfile,"folderListVal",e)},expression:"uploadfile.folderListVal"}},t._l(t.uploadfile.folderList,function(t){return i("el-option",{key:t.id,attrs:{label:t.dirname,value:t.id}})}))],1),t._v(" "),i("span",{staticClass:"form-group-inputbox-error"})])]),t._v(" "),i("div",{staticClass:"form-group-inputboxgroup clear margin-bottom-none"},[i("div",{staticClass:"form-group-inputbox"},[t._v("\n              "+t._s(t.fileListError)+"\n              "),i("h2",{staticClass:"form-group-inputbox-title"},[i("span",{staticClass:"account-icon icon-required"}),t._v("所选文件")]),t._v(" "),i("el-upload",{staticClass:"upload-demo",attrs:{drag:"",action:"",multiple:"","file-list":t.uploadfile.fileList,"auto-upload":!1,"show-file-list":!1,"on-change":t.fileListChange}},[i("i",{staticClass:"el-icon-upload"}),t._v(" "),i("div",{staticClass:"el-upload__text"},[t._v("将文件拖到此处，或"),i("em",[t._v("点击上传")])]),t._v(" "),i("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("不能上传音频和视频文件,不支持文件夹上传")])]),t._v(" "),i("div",{staticClass:"form-group-selectedfile-box"},t._l(t.uploadfile.fileList,function(e,a){return i("div",{staticClass:"form-group-selectedfile-item clear"},[i("span",{staticClass:"filemanage-icon icon-wd"}),t._v(" "),i("span",{staticClass:"form-group-selectedfile-filename"},[t._v(t._s(e.name))]),t._v(" "),e.typeCheck?t._e():i("span",{staticClass:"filemanage-icon icon-warning"}),t._v(" "),i("span",{staticClass:"el-icon-close",on:{click:function(e){t.deleteFile(a)}}})])}))],1),t._v(" "),1==t.type?i("div",{staticClass:"form-group-inputbox"},[i("h2",{staticClass:"form-group-inputbox-title"},[t._v("标签选择")]),t._v(" "),i("div",{staticClass:"form-group-inputbox-selectbox select-normal-40 left"},[i("el-select",{attrs:{filterable:"",placeholder:"请选择"},on:{change:function(e){t.changeModalselect("tagListId",e)}},model:{value:t.uploadfile.tagListVal,callback:function(e){t.$set(t.uploadfile,"tagListVal",e)},expression:"uploadfile.tagListVal"}},t._l(t.uploadfile.tagList,function(t){return i("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),i("span",{staticClass:"form-group-inputbox-error"})]):t._e()])])]),t._v(" "),i("div",{staticClass:"dialog_footer clear",attrs:{slot:"footer"},slot:"footer"},[i("button",{staticClass:"dialog-btn-submit btn-blue",class:{"btn-blue-disabled":!t.submitOk},on:{click:function(e){t.submitClick()}}},[t._v("上传")])])])],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"foldermanage-content-table-th clear"},[e("div",{staticClass:"table-th1"},[this._v("类目")]),this._v(" "),e("div",{staticClass:"table-th2"},[this._v("文件数量")]),this._v(" "),e("div",{staticClass:"table-th3"},[this._v("修改时间")])])}]};var c=i("C7Lr")(n,r,!1,function(t){i("1vHF")},"data-v-484293c4",null);e.default=c.exports}});
//# sourceMappingURL=143.62ab1902e63a83120b7c.js.map