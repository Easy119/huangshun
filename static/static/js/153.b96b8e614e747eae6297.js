webpackJsonp([153],{Wrg9:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=a("aA9S"),i=a.n(l),s=a("3cXf"),n=a.n(s),o=a("yclV"),r=a("2hMI"),_={data:function(){return{id:"",type:1,is_add_page:1,rate:1,total_selected_money:0,total_selected:[],relate_table_data:[],total_table_data:[{fof_id:"",event:"",plan_receive_date:"",sum_assign_fee:"",scale:"",unit:"",distribute_money:"",distribute_income:"",event_count:""}],detail_table_data:[]}},created:function(){this.is_add_page=this.$route.query.is_add_page,this.id=this.$route.query.id,this.type=this.$route.query.type,this.getAddInfo(),this.getRate()},computed:{},mounted:function(){},methods:{getAddInfo:function(){var t=this;Object(r._165)({fof_id:this.id,difference_sign:this.type}).then(function(e){1==e.data.msgNo?(t.relate_table_data=e.data.payload.event_log,t.detail_table_data=e.data.payload.detail,e.data.payload.event_log[0]?t.total_table_data[0].unit=e.data.payload.event_log[0].unit:t.total_table_data[0].unit=1):Object(o.g)("info",e.data.message)})},addSave:function(){var t=this;if(this.total_selected_money<this.total_table_data[0].sum_assign_fee)Object(o.g)("info","分配总额应小于待分配总额");else{this.total_table_data[0].fof_id=this.id;var e=this.total_table_data[0].distribute_money/this.total_table_data[0].sum_assign_fee;this.total_table_data[0].scale=this.toDecimal(e);for(var a=n()(this.total_table_data),l=n()(this.detail_table_data),i=this.total_selected,s=0,_=i.length;s<_;s++)i[s].payback_fof_id=i[s].id;var d=n()(i),c=!0;if(this.detail_table_data.forEach(function(t){!t.receive_date&&c&&(c=!1)}),!c)return Object(o.g)("info","实际到账日期不可为空!"),!1;Object(r.m)({fof_id:this.id,difference_sign:this.type,event:a,detail:l,event_log:d}).then(function(e){1==e.data.msgNo?(Object(o.g)("success",e.data.message),t.addCancel()):Object(o.g)("info",e.data.message)})}},downloadExcel:function(){Object(r._72)({fof_id:this.id,difference_sign:this.type}).then(function(t){1==t.data.msgNo?window.location.href=t.data.payload.url:Object(o.g)("info",t.data.message)})},uploadManageCompanyInfoExcel:function(){var t=this,e=this.$refs.inputer,a=e.files[0];return void 0!=a&&(/\.xl(s[xmb]|t[xm]|am|s)$/.test(a.name)?void Object(r._361)({},a).then(function(a){if(1==a.data.msgNo){Object(o.g)("success","导入成功");var l=a.data.payload.data;t.makeData(l)}else Object(o.g)("info","导入失败，请联系开发人员");e.value=""}):(Object(o.g)("info","请选择Excel格式文件"),e.value="",!1))},makeData:function(t){for(var e=0,a=t.length;e<a;e++)for(var l=0,s=this.detail_table_data.length;l<s;l++)t[e].investor_id==this.detail_table_data[l].investor_id&&(i()(this.detail_table_data[l],t[e]),console.log(this.detail_table_data[l]))},toDecimal:function(t){var e=parseFloat(t);if(!isNaN(e))return e=Math.round(1e4*t)/1e4},handleSelectionChange:function(t){console.log(t);for(var e=0,a=0,l=t.length;a<l;a++)2==t.unit?e+=Number(t[a].rest_fee)*rate:e+=Number(t[a].rest_fee);this.total_selected=t,e=e.toFixed(6),e=Object(o.j)(e),this.total_selected_money=e},calculate:function(t){parseFloat(this.detail_table_data[t].subscribe)<parseFloat(this.detail_table_data[t].principal_distribution)&&(Object(o.g)("info","分配本金应小于或等于实缴出资!"),this.detail_table_data[t].principal_distribution=0),this.detail_table_data[t].this_sum_distribution=Number(this.detail_table_data[t].principal_distribution)+Number(this.detail_table_data[t].final_income),this.detail_table_data[t].sum_distribution=Number(this.detail_table_data[t].this_sum_distribution)+Number(this.detail_table_data[t].last_sum_distribution);for(var e=this.detail_table_data,a=0,l=0,i=0,s=0,n=e.length;s<n;s++)e[s].principal_distribution||(e[s].principal_distribution=0),e[s].income_before_tax||(e[s].income_before_tax=0),e[s].this_sum_distribution||(e[s].this_sum_distribution=0),a=Number(a)+Number(e[s].principal_distribution),l=Number(l)+Number(e[s].income_before_tax),i=Number(i)+Number(e[s].this_sum_distribution);this.total_table_data[0].distribute_money=a,this.total_table_data[0].distribute_income=l,this.total_table_data[0].sum_assign_fee=i},addCancel:function(){if(1==this.type)var t="motherFunRunDataCashFlowHome";else t="selfAdministerFunRunDataCashFlowHome";this.$router.push({name:t,query:{id:this.id}})},chooseDate:function(t){if(!t)return this.total_table_data[0].event="",void(this.total_table_data[0].event_count="");this.getEventCountData()},getEventCountData:function(){var t=this;if(1==this.type)var e=2;else e=3;var a=this.total_table_data[0].plan_receive_date;Object(r._169)({type:e,id:this.id,cash_type:4,date:a,fund_type:"",fund_id:"",event_id:""}).then(function(e){1==e.data.msgNo?(t.total_table_data[0].event=e.data.payload.event_name,t.total_table_data[0].event_count=e.data.payload.event_count):Object(o.g)("info",e.data.message)})},getRate:function(){var t=this;Object(r._211)({}).then(function(e){console.log(e),1==e.data.msgNo?t.rate=e.data.payload.exchangeRate:Object(o.g)("info",e.data.message)})}}},d={render:function(){var t=this,e=t.$createElement,l=t._self._c||e;return l("div",{staticClass:"body"},[l("div",{staticClass:"cash_flow_table_box"},[t._m(0),t._v(" "),l("div",{staticClass:"relete_back_title flex_between"},[l("div",{},[t._v("\n\t\t\t\t\t本次已选择待分配总额"),l("span",[t._v(t._s(t.total_selected_money)+"万元")])])]),t._v(" "),l("div",{staticClass:"cash_flow_table"},[l("div",{staticClass:"under_fund_main table"},[l("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.relate_table_data,border:""},on:{"selection-change":t.handleSelectionChange}},[l("el-table-column",{attrs:{type:"selection",width:"55"}}),t._v(" "),l("el-table-column",{attrs:{prop:"event",label:"序号",width:"100",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n\t\t\t\t\t\t\t\t"+t._s(e.$index+1)+"\n\t\t\t\t\t\t\t")]}}])}),t._v(" "),l("el-table-column",{attrs:{prop:"receive_date",label:"到账日期",width:"180",sortable:""}}),t._v(" "),l("el-table-column",{attrs:{prop:"event",label:"事件名称",width:"180",sortable:""}}),t._v(" "),l("el-table-column",{attrs:{prop:"fund_name",label:"标的名称",width:"180",sortable:""}}),t._v(" "),l("el-table-column",{attrs:{prop:"payback_type_name",label:"回款类型",width:"180",sortable:""}}),t._v(" "),l("el-table-column",{attrs:{prop:"unit",label:"币种",width:"120",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n\t\t\t\t\t\t\t\t"+t._s(1==e.row.unit?"人民币":"美元")+"\n\t\t\t\t\t\t\t")]}}])}),t._v(" "),l("el-table-column",{attrs:{prop:"sum_back",label:"回款返本（万元）",width:"180",sortable:""}}),t._v(" "),l("el-table-column",{attrs:{prop:"sum_profile",label:"回款收益-税后（万元）",width:"220",sortable:""}}),t._v(" "),l("el-table-column",{attrs:{prop:"sum_calculate",label:"回款总额（万元）",width:"180",sortable:""}}),t._v(" "),l("el-table-column",{attrs:{prop:"rest_fee",label:"待分配余额（万元）",width:"180",sortable:""}}),t._v(" "),l("template",{slot:"empty"},[l("div",{staticClass:"table-nodata"},[l("img",{attrs:{src:a("urJZ")}}),t._v(" 没有对应数据\n\t\t\t\t\t\t\t")])])],2)],1)])]),t._v(" "),l("div",{staticClass:"cash_flow_table_box"},[t._m(1),t._v(" "),l("div",{staticClass:"cash_flow_table"},[l("div",{staticClass:"under_fund_main table"},[l("el-table",{ref:"",staticStyle:{width:"100%"},attrs:{data:t.total_table_data,border:""}},[l("el-table-column",{attrs:{prop:"plan_receive_date",label:"计划到账日期",width:"200",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[l("el-date-picker",{attrs:{editable:!1,type:"date","value-format":"yyyy-MM-dd",placeholder:"选择日期"},on:{change:t.chooseDate},model:{value:e.row.plan_receive_date,callback:function(a){t.$set(e.row,"plan_receive_date",a)},expression:"scope.row.plan_receive_date"}})]}}])}),t._v(" "),l("el-table-column",{attrs:{prop:"event",label:"事件",width:"200",sortable:""}}),t._v(" "),l("el-table-column",{attrs:{prop:"distribute_money",label:"分配本金（万元）",width:"200",sortable:""}}),t._v(" "),l("el-table-column",{attrs:{prop:"distribute_income",label:"分配收益-税前（万元）",width:"200",sortable:""}}),t._v(" "),l("el-table-column",{attrs:{prop:"sum_assign_fee",label:"分配总额（万元）",width:"200",sortable:""}}),t._v(" "),l("el-table-column",{attrs:{prop:"unit",label:"币种",width:"200",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n\t\t\t\t\t\t\t\t"+t._s(1==e.row.unit?"人民币":"美元")+"\n\t\t\t\t\t\t\t")]}}])}),t._v(" "),l("template",{slot:"empty"},[l("div",{staticClass:"table-nodata"},[l("img",{attrs:{src:a("urJZ")}}),t._v(" 没有对应数据\n\t\t\t\t\t\t\t")])])],2)],1)])]),t._v(" "),l("div",{staticClass:"cash_flow_table_box"},[t._m(2),t._v(" "),l("div",{staticClass:"cash_flow_table_title flex_end"},[l("div",{staticClass:"hover_btn flex_center cursor",on:{click:t.downloadExcel}},[l("span",{staticClass:"iconfont icon-daoru"}),t._v(" "),l("span",[t._v("下载投资人分配信息模版")])]),t._v(" "),l("div",{},[t._m(3),t._v(" "),l("input",{ref:"inputer",staticStyle:{display:"none"},attrs:{type:"file",id:"upload-fund-input"},on:{change:function(e){t.uploadManageCompanyInfoExcel(e)}}})])]),t._v(" "),l("div",{staticClass:"cash_flow_table"},[l("div",{staticClass:"under_fund_main table"},[l("el-table",{staticStyle:{width:"100%"},attrs:{data:t.detail_table_data,border:""}},[l("el-table-column",{attrs:{prop:"event",label:"序号",width:"100",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n\t\t\t\t\t\t\t\t"+t._s(e.$index+1)+"\n\t\t\t\t\t\t\t")]}}])}),t._v(" "),l("el-table-column",{attrs:{prop:"investor_name",label:"合伙人名称",width:"200",sortable:""}}),t._v(" "),l("el-table-column",{attrs:{prop:"subscribe",label:"实缴出资（万元）",width:"200",sortable:""}}),t._v(" "),l("el-table-column",{attrs:{prop:"subscribe_scale",label:"实缴占比",width:"150",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n\t\t\t\t\t\t\t\t"+t._s(e.row.subscribe_scale)+" %\n\t\t\t\t\t\t\t")]}}])}),t._v(" "),l("el-table-column",{attrs:{prop:"receive_date",label:"实际到账日期",width:"200",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[l("el-date-picker",{attrs:{editable:!1,type:"date","value-format":"yyyy-MM-dd",placeholder:"选择日期"},model:{value:e.row.receive_date,callback:function(a){t.$set(e.row,"receive_date",a)},expression:"scope.row.receive_date"}})]}}])}),t._v(" "),l("el-table-column",{attrs:{prop:"principal_distribution",label:"本金分配（万元）",width:"200",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[l("el-input",{attrs:{placeholder:"请输入",clearable:""},on:{input:function(a){t.calculate(e.$index)}},model:{value:e.row.principal_distribution,callback:function(a){t.$set(e.row,"principal_distribution",t._n(a))},expression:"scope.row.principal_distribution"}})]}}])}),t._v(" "),l("el-table-column",{attrs:{prop:"income_before_tax",label:"分配收益-税前（万元）",width:"200",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[l("el-input",{attrs:{placeholder:"",clearable:""},on:{input:function(a){t.calculate(e.$index)}},model:{value:e.row.income_before_tax,callback:function(a){t.$set(e.row,"income_before_tax",t._n(a))},expression:"scope.row.income_before_tax"}})]}}])}),t._v(" "),l("el-table-column",{attrs:{prop:"interest",label:"应付利息/利息收入（万元）",width:"230",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[l("el-input",{attrs:{placeholder:"",clearable:""},model:{value:e.row.interest,callback:function(a){t.$set(e.row,"interest",a)},expression:"scope.row.interest"}})]}}])}),t._v(" "),l("el-table-column",{attrs:{prop:"income_after_interest",label:"息后收益分配-税前（万元）",width:"230",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[l("el-input",{attrs:{placeholder:"",clearable:""},model:{value:e.row.income_after_interest,callback:function(a){t.$set(e.row,"income_after_interest",a)},expression:"scope.row.income_after_interest"}})]}}])}),t._v(" "),l("el-table-column",{attrs:{prop:"service_fee",label:"代扣代缴税款（20%）",width:"200",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[l("el-input",{attrs:{placeholder:"",clearable:""},model:{value:e.row.service_fee,callback:function(a){t.$set(e.row,"service_fee",a)},expression:"scope.row.service_fee"}})]}}])}),t._v(" "),l("el-table-column",{attrs:{prop:"final_income",label:"息后税后收益分配（万元）",width:"230",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[l("el-input",{attrs:{placeholder:"",clearable:""},on:{input:function(a){t.calculate(e.$index)}},model:{value:e.row.final_income,callback:function(a){t.$set(e.row,"final_income",a)},expression:"scope.row.final_income"}})]}}])}),t._v(" "),l("el-table-column",{attrs:{prop:"this_sum_distribution",label:"本次分配总额（万元）",width:"200",sortable:""}}),t._v(" "),l("el-table-column",{attrs:{prop:"last_sum_distribution",label:"上次累计分配总额（万元）",width:"230",sortable:""}}),t._v(" "),l("el-table-column",{attrs:{prop:"sum_distribution",label:"累计分配金额（万元）",width:"200",sortable:""}}),t._v(" "),l("template",{slot:"empty"},[l("div",{staticClass:"table-nodata"},[l("img",{attrs:{src:a("urJZ")}}),t._v(" 没有对应数据\n\t\t\t\t\t\t\t")])])],2)],1)])]),t._v(" "),t.is_add_page?l("div",{staticClass:"submit_btn_box flex_center"},[l("button",{staticClass:"hover_btn",on:{click:t.addCancel}},[t._v("取消")]),t._v(" "),l("button",{staticClass:"blue_btn",on:{click:t.addSave}},[t._v("保存")])]):t._e()])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"cash_flow_table_title flex_between"},[e("div",{staticClass:"flex_start"},[e("span",{staticClass:"circle_blue"}),this._v(" "),e("span",{staticClass:"name"},[this._v("关联回款")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"cash_flow_table_title flex_between"},[e("div",{staticClass:"flex_start"},[e("span",{staticClass:"circle_blue"}),this._v(" "),e("span",{staticClass:"name"},[this._v("分配")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"cash_flow_table_title flex_between"},[e("div",{staticClass:"flex_start"},[e("span",{staticClass:"circle_blue"}),this._v(" "),e("span",{staticClass:"name"},[this._v("分配明细")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("label",{attrs:{for:"upload-fund-input"}},[e("div",{staticClass:"table-group-title-btn btn-blue-border"},[e("span",{staticClass:"iconfont icon-daochu"}),this._v("导入投资人分配信息\n\t\t\t\t\t\t")])])}]};var c=a("C7Lr")(_,d,!1,function(t){a("adND")},"data-v-3e9d3b8e",null);e.default=c.exports},adND:function(t,e){}});
//# sourceMappingURL=153.b96b8e614e747eae6297.js.map